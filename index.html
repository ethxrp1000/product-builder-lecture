
<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PVYKGJS6WM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-PVYKGJS6WM');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숨, 쉼 - 명상 챌린지</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500&display=swap');

        :root {
            --bg-color: #F0F2F0;
            --primary-color: #5D6D7E;
            --secondary-color: #A3B18A;
            --text-color: #34495E;
            --highlight-color: #588157;
        }

        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease-in-out;
        }

        .app-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .container {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.85);
            padding: 40px 50px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 400px;
            width: 90%;
            transition: all 0.5s ease;
        }

        h1 {
            font-weight: 500;
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        p {
            font-size: 16px;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        .challenge-buttons button {
            background-color: transparent;
            border: 2px solid var(--secondary-color);
            color: var(--text-color);
            padding: 12px 24px;
            margin: 0 8px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 400;
            transition: all 0.3s ease;
        }

        .challenge-buttons button:hover, .challenge-buttons button.active {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .ready-container {
            margin-top: 30px;
            display: none;
        }

        .timer-container {
            margin-top: 30px;
            display: none;
        }

        #timer {
            font-size: 64px;
            font-weight: 300;
            color: var(--highlight-color);
            margin-bottom: 20px;
        }

        #message {
            font-size: 18px;
            font-weight: 500;
            color: var(--primary-color);
            min-height: 27px;
        }

        #reset-button, #start-meditation-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 32px;
            margin-top: 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        #reset-button:hover, #start-meditation-button:hover {
            background-color: #4A5A6A;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        #reset-button {
            display: none;
        }

        #progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 20px;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--highlight-color);
            border-radius: 5px;
            transition: width 1s linear;
        }

        #fullscreen-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary-color);
        }

        #breath-guide {
            width: 150px;
            height: 150px;
            background-color: var(--highlight-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
            color: white;
            font-size: 24px;
            font-weight: 500;
            opacity: 0.9;
            box-shadow: 0 0 20px rgba(90, 129, 87, 0.5);
            transition: transform 4s ease-in-out;
            transform: scale(0.8);
        }

        .ready-message {
            font-size: 20px;
            color: var(--primary-color);
            margin: 20px 0;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <div class="container">
            <button id="fullscreen-button">⛶</button>
            <h1>명상 챌린지</h1>
            <p>잠시 모든 것을 잊고, 온전히 숨에 집중하는 시간</p>
            <div class="challenge-buttons">
                <button data-duration="60">1분</button>
                <button data-duration="120">2분</button>
                <button data-duration="180">3분</button>
            </div>
            
            <!-- Ready screen with start button -->
            <div class="ready-container">
                <div id="breath-guide"><span id="breath-text"></span></div>
                <p class="ready-message">편안한 자세로 앉아 준비가 되면 시작하세요</p>
                <button id="start-meditation-button">명상 시작</button>
            </div>

            <!-- Timer screen -->
            <div class="timer-container">
                <div id="timer">00:00</div>
                <div id="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
                <p id="message"></p>
                <button id="reset-button">다시하기</button>
            </div>
        </div>
    </div>


    <script>
        const challengeButtons = document.querySelector('.challenge-buttons');
        const readyContainer = document.querySelector('.ready-container');
        const timerContainer = document.querySelector('.timer-container');
        const timerDisplay = document.getElementById('timer');
        const messageDisplay = document.getElementById('message');
        const resetButton = document.getElementById('reset-button');
        const startMeditationButton = document.getElementById('start-meditation-button');
        
        const initialUI = document.querySelector('.container p');
        const h1 = document.querySelector('h1');
        const progressBar = document.getElementById('progress-bar');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const breathGuide = document.getElementById('breath-guide');
        const breathText = document.getElementById('breath-text');

        const languageData = {
            'ko': {
                h1: '명상 챌린지',
                initialP: '잠시 모든 것을 잊고, 온전히 숨에 집중하는 시간',
                challengeButtons: ['1분', '2분', '3분'],
                readyMessage: '편안한 자세로 앉아 준비가 되면 시작하세요',
                startButton: '명상 시작',
                messageInitial: '숨을 깊게 들이마시고, 천천히 내쉬세요.',
                inhale: '들이쉬세요',
                hold: '참으세요',
                exhale: '내쉬세요',
                messageFinish: '명상을 완료했습니다. 편안한 하루 보내세요.',
                resetButton: '다시하기'
            },
            'en': {
                h1: 'Meditation Challenge',
                initialP: 'Forget everything for a moment, and focus entirely on your breath.',
                challengeButtons: ['1 min', '2 min', '3 min'],
                readyMessage: 'Sit in a comfortable position and start when you are ready.',
                startButton: 'Start Meditation',
                messageInitial: 'Breathe in deeply, and exhale slowly.',
                inhale: 'Inhale',
                hold: 'Hold',
                exhale: 'Exhale',
                messageFinish: 'Meditation complete. Have a peaceful day.',
                resetButton: 'Reset'
            }
        };

        let currentLang = 'ko'; // Default language

        function setLanguage(lang) {
            currentLang = lang;
            const texts = languageData[lang];

            // Update static texts
            document.querySelector('h1').textContent = texts.h1;
            document.querySelector('.container p').textContent = texts.initialP;
            document.getElementById('start-meditation-button').textContent = texts.startButton;
            document.getElementById('reset-button').textContent = texts.resetButton;

            // Update challenge buttons
            const challengeButtonsElements = document.querySelectorAll('.challenge-buttons button');
            challengeButtonsElements.forEach((button, index) => {
                button.textContent = texts.challengeButtons[index];
            });

            // Update dynamic messages
            // These will be set when needed by other functions, but ensure initial state is correct
            document.querySelector('.ready-message').textContent = texts.readyMessage;
        }

        const backgroundImages = [
            "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=2071&auto=format&fit=crop", // Sunday
            "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1948&auto=format&fit=crop", // Monday
            "https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?q=80&w=2070&auto=format&fit=crop", // Tuesday
            "https://images.unsplash.com/photo-1426604966848-d7adac402bff?q=80&w=2070&auto=format&fit=crop", // Wednesday
            "https://images.unsplash.com/photo-1501854140801-50d01698950b?q=80&w=2175&auto=format&fit=crop", // Thursday
            "https://images.unsplash.com/photo-1433086966358-54859d0ed716?q=80&w=1974&auto=format&fit=crop", // Friday
            "https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?q=80&w=2070&auto=format&fit=crop"  // Saturday
        ];

        let timer;
        let totalSeconds = 0;
        let initialDuration = 0;
        let selectedDuration = 0;
        let currentPhase = 'inhale'; // Track breathing phase
        let breathCycleTimeout;

        document.addEventListener('DOMContentLoaded', () => {
            const userLang = navigator.language.startsWith('ko') ? 'ko' : 'en';
            setLanguage(userLang);

            const dayOfWeek = new Date().getDay();
            document.body.style.backgroundImage = `url('${backgroundImages[dayOfWeek]}')`;
        });

        challengeButtons.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                selectedDuration = parseInt(e.target.dataset.duration, 10);
                showReadyScreen();
            }
        });

        startMeditationButton.addEventListener('click', () => {
            startChallenge(selectedDuration);
        });

        resetButton.addEventListener('click', () => {
            resetChallenge();
        });

        fullscreenButton.addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        });

        function showReadyScreen() {
            // UI 업데이트
            challengeButtons.style.display = 'none';
            initialUI.style.display = 'none';
            document.querySelector('h1').style.display = 'none';
            readyContainer.style.display = 'block';
            
            // Show preview breathing animation
            breathGuide.style.display = 'flex';
            
            // Initial small animation
            breathGuide.style.transform = 'scale(0.2)'; // Start very small
            setTimeout(() => {
                breathGuide.style.transform = 'scale(0.8)'; // Animate to initial breathing size
            }, 50); // A small delay to ensure the initial transform is registered before the next one

            // Start the actual breathing cycle after the initial animation
            setTimeout(() => {
                startPreviewBreathAnimation();
            }, 4000); // Match this with the CSS transition duration for transform
        }

        function startPreviewBreathAnimation() {
            // Initial state for the cycle (the breathGuide will already be at scale(0.8) from showReadyScreen)
            breathText.textContent = languageData[currentLang].inhale;
            
            const previewCycle = () => {
                // Inhale phase
                breathText.textContent = languageData[currentLang].inhale;
                breathGuide.style.transform = 'scale(1.2)';
                
                setTimeout(() => {
                    // Hold phase
                    breathText.textContent = languageData[currentLang].hold;
                }, 4000);
                
                setTimeout(() => {
                    // Exhale phase
                    breathText.textContent = languageData[currentLang].exhale;
                    breathGuide.style.transform = 'scale(0.8)';
                }, 6000);
            };
            
            previewCycle();
            breathCycleTimeout = setInterval(previewCycle, 12000);
        }

        function stopPreviewBreathAnimation() {
            clearInterval(breathCycleTimeout);
        }

        function startBreathGuideAnimation() {
            // Reset and start fresh
            breathGuide.style.transform = 'scale(0.8)';
            currentPhase = 'inhale';
            
            const breathCycle = () => {
                // Inhale phase (4 seconds)
                currentPhase = 'inhale';
                breathText.textContent = languageData[currentLang].inhale;
                breathGuide.style.transform = 'scale(1.2)';
                
                setTimeout(() => {
                    // Hold phase (4 seconds)
                    currentPhase = 'hold';
                    breathText.textContent = languageData[currentLang].hold;
                }, 4000);
                
                setTimeout(() => {
                    // Exhale phase (6 seconds)
                    currentPhase = 'exhale';
                    breathText.textContent = languageData[currentLang].exhale;
                    breathGuide.style.transform = 'scale(0.8)';
                }, 6000);
            };
            
            // Start immediately
            breathCycle();
            
            // Repeat every 10 seconds (4s inhale + 4s hold + 6s exhale)
            breathCycleTimeout = setInterval(breathCycle, 12000);
        }

        function startChallenge(duration) {
            stopPreviewBreathAnimation();
            
            totalSeconds = duration;
            initialDuration = duration;
            
            // UI 업데이트
            readyContainer.style.display = 'none';
            timerContainer.style.display = 'block';
            resetButton.style.display = 'none';
            messageDisplay.textContent = languageData[currentLang].messageInitial;

            // Start breath guide with fresh animation
            breathGuide.style.display = 'flex';
            startBreathGuideAnimation();

            updateTimerDisplay();

            timer = setInterval(() => {
                totalSeconds--;
                if (totalSeconds < 0) {
                    finishChallenge();
                } else {
                    updateTimerDisplay();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;

            const progressPercentage = ((initialDuration - totalSeconds) / initialDuration) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function finishChallenge() {
            clearInterval(timer);
            clearInterval(breathCycleTimeout);
            breathGuide.style.display = 'none';
            messageDisplay.textContent = languageData[currentLang].messageFinish;
            resetButton.style.display = 'block';
        }

        function resetChallenge() {
            clearInterval(timer);
            clearInterval(breathCycleTimeout);
            
            // UI 초기화
            h1.textContent = languageData[currentLang].h1;
            document.querySelector('h1').style.display = 'block';
            challengeButtons.style.display = 'block';
            initialUI.style.display = 'block';
            readyContainer.style.display = 'none';
            timerContainer.style.display = 'none';
            resetButton.style.display = 'none';
            messageDisplay.textContent = '';
            progressBar.style.width = '0%';
            breathGuide.style.display = 'none';
            breathGuide.style.transform = 'scale(1)';
            breathText.textContent = '';
        }
    </script>
</body>
</html>